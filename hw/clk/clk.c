#define NUM_REGS_MAX 350

typedef struct Reg_Data{
   unsigned char Reg_Addr;
   unsigned char Reg_Val;
   unsigned char Reg_Mask;
}Reg_Data;

static Reg_Data  Reg_Store[] = {
{ 27,0x70,0x80},
{ 28,0x16,0xFF},
{ 29,0x90,0xFF},
{ 30,0xB0,0xFF},
{ 31,0xC0,0xFF},
{ 32,0xC0,0xFF},
{ 33,0xC0,0xFF},
{ 34,0xC0,0xFF},
{ 35,0x00,0xFF},
{ 36,0x06,0x1F},
{ 37,0x06,0x1F},
{ 38,0x06,0x1F},
{ 39,0x06,0x1F},//{ 39,0x03,0x1F},
{ 40,0x63,0xFF},
{ 41,0x0C,0x7F},
{ 42,0x23,0x3F},//{ 42,0x37,0x3F},
{ 43,0x00,0x00},
{ 44,0x00,0x00},
{ 45,0x00,0xFF},
{ 46,0x00,0xFF},
{ 47,0x14,0x3F},
{ 48,0x3D,0xFF},
{ 49,0x00,0xFF},
{ 50,0xC4,0xFF},
{ 51,0x07,0xFF},
{ 52,0x10,0xFF},
{ 53,0x00,0xFF},
{ 54,0x07,0xFF},
{ 55,0x00,0xFF},
{ 56,0x00,0xFF},
{ 57,0x00,0xFF},
{ 58,0x00,0xFF},
{ 59,0x01,0xFF},
{ 60,0x00,0xFF},
{ 61,0x00,0xFF},
{ 62,0x00,0x3F},
{ 63,0x10,0xFF},
{ 64,0x00,0xFF},
{ 65,0x07,0xFF},
{ 66,0x00,0xFF},
{ 67,0x00,0xFF},
{ 68,0x00,0xFF},
{ 69,0x00,0xFF},
{ 70,0x01,0xFF},
{ 71,0x00,0xFF},
{ 72,0x00,0xFF},
{ 73,0x00,0x3F},
{ 74,0x10,0xFF},
{ 75,0x13,0xFF},
{ 76,0x04,0xFF},
{ 77,0x10,0xFF},
{ 78,0x00,0xFF},
{ 79,0x00,0xFF},
{ 80,0x00,0xFF},
{ 81,0x14,0xFF},
{ 82,0x00,0xFF},
{ 83,0x00,0xFF},
{ 84,0x00,0x3F},
{ 85,0x10,0xFF},
#if 1     //89.01M
{ 86,0xA5,0xFF},
{ 87,0x0B,0xFF},
{ 88,0xF4,0xFF},
{ 89,0x5A,0xFF},
{ 90,0x00,0xFF},
{ 91,0x00,0xFF},
{ 92,0xC7,0xFF},
{ 93,0x22,0xFF},
#else   //50.01M
{ 86,0x4B,0xFF},
{ 87,0x16,0xFF},
{ 88,0x7C,0xFF},
{ 89,0x0E,0xFF},
{ 90,0x00,0xFF},
{ 91,0x00,0xFF},
{ 92,0x83,0xFF},
{ 93,0x06,0xFF},
#endif
{ 94,0x00,0xFF},
{ 95,0x00,0x3F},
{ 96,0x10,0x00},
{ 97,0x99,0xFF},
{ 98,0x2E,0xFF},
{ 99,0x0C,0xFF},
{100,0x00,0xFF},
{101,0x00,0xFF},
{102,0x00,0xFF},
{103,0x05,0xFF},
{104,0x00,0xFF},
{105,0x00,0xFF},
{106,0x80,0xBF},
{107,0x00,0xFF},
{108,0x00,0xFF},
{109,0x00,0xFF},
{110,0x40,0xFF},
{111,0x00,0xFF},
{112,0x00,0xFF},
{113,0x00,0xFF},
{114,0x40,0xFF},
{115,0x00,0xFF},
{116,0x80,0xFF},
{117,0x00,0xFF},
{118,0x40,0xFF},
{119,0x00,0xFF},
{120,0x00,0xFF},
{121,0x00,0xFF},
{122,0x40,0xFF},
{123,0x00,0xFF},
{124,0x00,0xFF},
{125,0x00,0xFF},
{126,0x00,0xFF},
{127,0x00,0xFF},
{128,0x00,0xFF},
{129,0x00,0x0F},
{130,0x00,0x0F},
{131,0x00,0xFF},
{132,0x00,0xFF},
{133,0x00,0xFF},
{134,0x00,0xFF},
{135,0x00,0xFF},
{136,0x00,0xFF},
{137,0x00,0xFF},
{138,0x00,0xFF},
{139,0x00,0xFF},
{140,0x00,0xFF},
{141,0x00,0xFF},
{142,0x00,0xFF},
{143,0x00,0xFF},
{144,0x00,0xFF},
{145,0x00,0x00},
{146,0xFF,0x00},
{147,0x00,0x00},
{148,0x00,0x00},
{149,0x00,0x00},
{150,0x00,0x00},
{151,0x00,0x00},
{152,0x00,0xFF},
{153,0x00,0xFF},
{154,0x00,0xFF},
{155,0x00,0xFF},
{156,0x00,0xFF},
{157,0x00,0xFF},
{158,0x00,0x0F},
{159,0x00,0x0F},
{160,0x00,0xFF},
{161,0x00,0xFF},
{162,0x00,0xFF},
{163,0x00,0xFF},
{164,0x00,0xFF},
{165,0x00,0xFF},
{166,0x00,0xFF},
{167,0x00,0xFF},
{168,0x00,0xFF},
{169,0x00,0xFF},
{170,0x00,0xFF},
{171,0x00,0xFF},
{172,0x00,0xFF},
{173,0x00,0xFF},
{174,0x00,0xFF},
{175,0x00,0xFF},
{176,0x00,0xFF},
{177,0x00,0xFF},
{178,0x00,0xFF},
{179,0x00,0xFF},
{180,0x00,0xFF},
{181,0x00,0x0F},
{182,0x00,0xFF},
{183,0x00,0xFF},
{184,0x00,0xFF},
{185,0x00,0xFF},
{186,0x00,0xFF},
{187,0x00,0xFF},
{188,0x00,0xFF},
{189,0x00,0xFF},
{190,0x00,0xFF},
{191,0x00,0xFF},
{192,0x00,0xFF},
{193,0x00,0xFF},
{194,0x00,0xFF},
{195,0x00,0xFF},
{196,0x00,0xFF},
{197,0x00,0xFF},
{198,0x00,0xFF},
{199,0x00,0xFF},
{200,0x00,0xFF},
{201,0x00,0xFF},
{202,0x00,0xFF},
{203,0x00,0x0F},
{204,0x00,0xFF},
{205,0x00,0xFF},
{206,0x00,0xFF},
{207,0x00,0xFF},
{208,0x00,0xFF},
{209,0x00,0xFF},
{210,0x00,0xFF},
{211,0x00,0xFF},
{212,0x00,0xFF},
{213,0x00,0xFF},
{214,0x00,0xFF},
{215,0x00,0xFF},
{216,0x00,0xFF},
{217,0x00,0xFF},
{218,0x00,0xFF},
{219,0x00,0xFF},
{220,0x00,0xFF},
{221,0x0D,0xFF},
{222,0x00,0xFF},
{223,0x00,0xFF},
{224,0xF4,0xFF},
{225,0xF0,0xFF},
{226,0x00,0xFF},
{227,0x00,0xFF},
{228,0x00,0xFF},
{229,0x00,0xFF},
{231,0x00,0xFF},
{232,0x00,0xFF},
{233,0x00,0xFF},
{234,0x00,0xFF},
{235,0x00,0xFF},
{236,0x00,0xFF},
{237,0x00,0xFF},
{238,0x14,0xFF},
{239,0x00,0xFF},
{240,0x00,0xFF},
{242,0x00,0xFF},
{243,0xF0,0xFF},
{244,0x00,0xFF},
{245,0x00,0xFF},
{247,0x00,0xFF},
{248,0x00,0xFF},
{249,0xA8,0xFF},
{250,0x00,0xFF},
{251,0x84,0xFF},
{246,0x02,0xFF},
{246,0x00,0xFF}
};

static char getIndexByaddr(char addr)
{
    int i;
    //Register Map
    for(i=0;i<sizeof(Reg_Store)/sizeof(Reg_Data);i++)
    {
        if(Reg_Store[i].Reg_Addr == addr)
        {
            return i;
        }
    }
    return -1;
}


static int calc_p1(int a,int b,int c)
{
    int p1 = (a*c+b)*128/c - 512;
    return p1;
}

static int calc_p2(int a,int b,int c)
{
    int p2 = (b*128)%c;
    return p2;
}

static int calc_p3(int a,int b,int c)
{
    return c;
}

static void calc_msx_reg_p1(int p1)
{
    int reg = p1;
    int addr = 86;
    int index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = reg&0xFF;
    //printf("1 p1 0x%x index %d addr %d val 0x%x\n",p1,index,Reg_Store[index].Reg_Addr,Reg_Store[index].Reg_Val);

    addr = 87;
    index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = (reg>>8)&0xFF;
    //printf("2 p1 0x%x index %d addr %d val 0x%x\n",p1,index,Reg_Store[index].Reg_Addr,Reg_Store[index].Reg_Val);

    addr = 88;
    index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = (reg>>16)&0x03;
    //printf("3 p1 0x%x index %d addr %d val 0x%x\n",p1,index,Reg_Store[index].Reg_Addr,Reg_Store[index].Reg_Val);
}

static void calc_msx_reg_p2(int p2)
{
    int reg = p2;
    int addr = 88;
    int index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val |= ((reg&0x3f)<<2);
    addr = 89;
    index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = (reg>>6)&0xFF;
    addr = 90;
    index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = (reg>>14)&0xFF;
    addr = 91;
    index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = (reg>>22)&0xFF;
}

static void calc_msx_reg_p3(int p3)
{
    int reg = p3;
    int addr = 92;
    int index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = reg&0xff;
    addr = 93;
    index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = (reg>>8)&0xFF;
    addr = 94;
    index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = (reg>>16)&0xFF;
    addr = 95;
    index = getIndexByaddr(addr);
    Reg_Store[index].Reg_Val = (reg>>24)&0xFF;
}

//5338 i2c init;
void clock_5338_init()
{
    char value;
    int i,j;

    //HI_UNF_I2C_Read(1, 0x2c, 0x00, 1, &value, 1);
    printf("i2c 0x58 is %d\n",value);

    value = 0xce;

    //HI_UNF_I2C_Write(1, 0x2c, 0x00, 1, &value, 1);
    printf("i2c 0x58 is %d\n",value);

    //HI_UNF_I2C_Read(1, 0x2c, 0x00, 1, &value, 1);
    printf("i2c 0x58 is %d\n",value);

    HI_UNF_I2C_Read(0, 0x70, 2, 1, &value, 1);
    printf("53382 factory id is %d\n",value);

    //Register Map
    for(i=0;i<sizeof(Reg_Store)/sizeof(Reg_Data);i++)
    {
        HI_UNF_I2C_Write(0, 0x70, Reg_Store[i].Reg_Addr, 1, &Reg_Store[i].Reg_Val, 1);
        //HI_UNF_I2C_Read(0, 0x70, Reg_Store[i].Reg_Addr, 1, &value, 1);
        /*if((Reg_Store[i].Reg_Addr>=86) && (Reg_Store[i].Reg_Addr<=95))
        {
            printf("i %d regAddr :%d val:%d\n",i,Reg_Store[i].Reg_Addr,Reg_Store[i].Reg_Val);
        }*/
    }
}

void clock_5338_setFreq(int outFreq)
{
     int fvco   = 2430;
     double msx = (double)(fvco*1000)/outFreq;
     int msx_a = (int)msx;
     double msx_p23 = msx - msx_a;
     int msx_b =  (int)(msx_p23*10000);
     int msx_c = 10000;

     //msx_b = 27;
     //msx_b = 297;
     //msx_c = 989;

     int msx_p1 = calc_p1(msx_a,msx_b,msx_c);
     int msx_p2 = calc_p2(msx_a,msx_b,msx_c);
     int msx_p3 = calc_p3(msx_a,msx_b,msx_c);

     calc_msx_reg_p1(msx_p1);
     calc_msx_reg_p2(msx_p2);
     calc_msx_reg_p3(msx_p3);

     printf("outFreq is %f,msx %lf  msx_abc %d:%d:%d,msx_p123 %d %d %d\n",((float)outFreq/1000),msx,
            msx_a,msx_b,msx_c,msx_p1,msx_p2,msx_p3);
     //Register Map
     int i;
     for(i=0;i<sizeof(Reg_Store)/sizeof(Reg_Data);i++)
     {
         //char value;
         HI_UNF_I2C_Write(0, 0x70, Reg_Store[i].Reg_Addr, 1, &Reg_Store[i].Reg_Val, 1);
         //HI_UNF_I2C_Read(0, 0x70, Reg_Store[i].Reg_Addr, 1, &value, 1);
         /*if((Reg_Store[i].Reg_Addr>=86) && (Reg_Store[i].Reg_Addr<=95))
         {
             printf("i %d regAddr :%d val:%x\n",i,Reg_Store[i].Reg_Addr,Reg_Store[i].Reg_Val);
         }*/
     }
}

